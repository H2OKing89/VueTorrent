import{a0 as fe,d as w,h as z,c as U,B as E,D as x,G as a,I as _,J as p,M as Q,N as A,m as e,S as $,n as ge,u as s,K as F,O as me,P as pe,Q as G,H as he,q as ve,F as ye,T as Se,L as ke}from"./vue-w4JYRGSv.js";import{Z as Ve,$ as P,V as H,k as h,c as be,u as te,d as J,e as we,j as q,l as W,f as Y,g as Ee,a as ne,i as Z,a0 as ie,w as Pe,E as _e,G as Te,F as Ce,o as Ne,a1 as X,a2 as xe,q as M,r as De,s as N,H as Ie,a3 as $e,a4 as Me,t as ee,M as Ue,N as qe,v as ae,x as Re,a5 as Be,a6 as Le,a7 as Qe}from"./index-BzkWC7uF.js";import{a as Ae}from"./vuetify-DUy_TGH5.js";const se=fe("searchEngine",()=>{const S=w([]),k=w([]);function l(){S.value.push({uniqueId:Ve(),id:0,lastQuery:"",query:"",itemsPerPage:10,filters:{title:"",category:"all",plugin:"enabled"},results:[],timer:null})}function g(n){S.value=S.value.filter(v=>v.uniqueId!==n)}async function o(n){const v=await P.startSearch(n.query,n.filters.category,[n.filters.plugin]);n.id=v.id,n.results=[],n.lastQuery=n.query}async function T(n){const v=await P.getSearchResults(n.id,n.results.length);return n.results.push(...v.results),v.status}async function c(n){n.id&&n.id!==0&&await P.stopSearch(n.id),n.id=0}async function d(){k.value=await P.getSearchPlugins()}async function C(n){await P.installSearchPlugin([n])}async function D(n){await P.uninstallSearchPlugin([n])}async function V(n){await P.enableSearchPlugin([n.name],!n.enabled)}async function I(){await P.updateSearchPlugins()}async function b(n,v){await P.downloadTorrentWithSearchPlugin(n,v)}return{searchData:S,searchPlugins:k,createNewTab:l,deleteTab:g,runNewSearch:o,refreshResults:T,stopSearch:c,fetchSearchPlugins:d,installSearchPlugin:C,uninstallSearchPlugin:D,toggleSearchPlugin:V,updatePlugins:I,downloadTorrent:b,$reset:()=>{S.value=[],k.value=[],l()}}},{persistence:{enabled:!0,storageItems:[{storage:sessionStorage}]}}),Fe={key:1,"data-testid":"mixedbtn-text"},le=z({__name:"MixedButton",props:{mobileOverride:{type:Boolean,default:!1},mobileValue:{type:Boolean},position:{},icon:{},text:{}},setup(S){const k=S,{mobile:l}=Ae(),g=U(()=>k.mobileOverride?k.mobileValue:l.value);return(o,T)=>(E(),x(h,{icon:g.value},{default:a(()=>[g.value||o.position==="left"?(E(),x(H,{key:0,"data-testid":"mixedbtn-icon-left"},{default:a(()=>[_(p(o.icon),1)]),_:1})):Q("",!0),g.value?Q("",!0):(E(),A("span",Fe,p(o.text),1)),!g.value&&o.position==="right"?(E(),x(H,{key:2,"data-testid":"mixedbtn-icon-right"},{default:a(()=>[_(p(o.icon),1)]),_:1})):Q("",!0)]),_:1},8,["icon"]))}}),He=["href","title"],ze=z({__name:"PluginManagerDialog",props:{guid:{}},setup(S){const k=S,{isOpened:l}=be(k.guid),{t:g}=te(),o=se(),T=[{title:g("dialogs.pluginManager.headers.enabled"),key:"enabled",sortable:!1},{title:g("dialogs.pluginManager.headers.name"),key:"fullName"},{title:g("dialogs.pluginManager.headers.version"),key:"version"},{title:g("dialogs.pluginManager.headers.url"),key:"url"},{title:g("dialogs.pluginManager.headers.actions"),key:"actions"}],c=w(!1),d=w(!1),C=w(!1),D=w(!1),V=w("");async function I(f){await o.toggleSearchPlugin(f),await o.fetchSearchPlugins()}async function b(){d.value=!0,await o.updatePlugins().then(()=>new Promise(f=>setTimeout(f,2e3))),await o.fetchSearchPlugins(),d.value=!1}async function n(){r(),c.value=!0,await o.installSearchPlugin(V.value),V.value="",setTimeout(()=>{o.fetchSearchPlugins().then(()=>{c.value=!1})},1e3)}async function v(f){c.value=!0,await o.uninstallSearchPlugin(f.name),await o.fetchSearchPlugins(),c.value=!1}const R=()=>{l.value=!1};function r(){C.value=!1}return(f,y)=>(E(),x(W,{modelValue:s(l),"onUpdate:modelValue":y[4]||(y[4]=u=>me(l)?l.value=u:null)},{default:a(()=>[e(J,null,{default:a(()=>[e(we,{class:"d-flex"},{default:a(()=>[$("div",null,p(f.$t("dialogs.pluginManager.title")),1),e(q),e(le,{icon:"mdi-update",text:f.$t("dialogs.pluginManager.update"),color:"accent",class:"mr-2",loading:d.value,onClick:b},null,8,["text","loading"]),e(W,{modelValue:C.value,"onUpdate:modelValue":y[3]||(y[3]=u=>C.value=u)},{activator:a(({props:u})=>[e(le,ge({icon:"mdi-toy-brick-plus",text:f.$t("dialogs.pluginManager.install.activator")},u,{color:"primary"}),null,16,["text"])]),default:a(()=>[e(J,{title:f.$t("dialogs.pluginManager.install.title")},{default:a(()=>[e(Y,null,{default:a(()=>[e(s(Ee),{modelValue:D.value,"onUpdate:modelValue":y[1]||(y[1]=u=>D.value=u),onSubmit:y[2]||(y[2]=F(()=>{},["prevent"]))},{default:a(()=>[e(ne,{modelValue:V.value,"onUpdate:modelValue":y[0]||(y[0]=u=>V.value=u),autofocus:"",label:f.$t("dialogs.pluginManager.install.label")},null,8,["modelValue","label"])]),_:1},8,["modelValue"])]),_:1}),e(Z,null,{default:a(()=>[e(q),e(h,{color:"error",onClick:r},{default:a(()=>[_(p(f.$t("common.cancel")),1)]),_:1}),e(h,{color:"accent",onClick:n},{default:a(()=>[_(p(f.$t("common.ok")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),e(Y,null,{default:a(()=>[e(ie,{mobile:null,headers:T,"items-per-page":"-1",items:s(o).searchPlugins,"sort-by":[{key:"fullName",order:"asc"}],loading:c.value},{"item.enabled":a(({item:u})=>[e(Pe,{"model-value":u.enabled,onClick:B=>I(u)},null,8,["model-value","onClick"])]),"item.url":a(({item:u})=>[$("a",{href:u.url,title:u.name},p(u.url),9,He)]),"item.actions":a(({item:u})=>[e(H,{color:"red",icon:"mdi-delete",onClick:B=>v(u)},null,8,["onClick"])]),_:2},1032,["items","loading"])]),_:1}),e(Z,null,{default:a(()=>[e(q),e(h,{color:"accent",onClick:R},{default:a(()=>[_(p(f.$t("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ke={class:"pa-3"},Oe={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},je={class:"d-flex justify-end"},Ye=z({__name:"SearchEngine",setup(S){const k=pe(),{t:l}=te(),g=_e(),o=Te(),T=Ce(),c=se(),{searchData:d}=G(c),{useBinarySize:C,dateFormat:D}=G(Ne()),V=w(),I=w(!1),b=w(0),n=U(()=>[{title:l("searchEngine.headers.fileName"),key:"fileName"},{title:l("searchEngine.headers.fileSize"),key:"fileSize"},{title:l("searchEngine.headers.nbSeeders"),key:"nbSeeders"},{title:l("searchEngine.headers.nbLeechers"),key:"nbLeechers"},...o.usesQbit5?[{title:l("searchEngine.headers.engineName"),key:"engineName"},{title:l("searchEngine.headers.pubDate"),key:"pubDate"}]:[{title:l("searchEngine.headers.siteUrl"),key:"siteUrl"}],{title:"",key:"actions",sortable:!1}]),v=[{title:l("searchEngine.filters.category.movies"),value:"movies"},{title:l("searchEngine.filters.category.tv"),value:"tv"},{title:l("searchEngine.filters.category.music"),value:"music"},{title:l("searchEngine.filters.category.games"),value:"games"},{title:l("searchEngine.filters.category.anime"),value:"anime"},{title:l("searchEngine.filters.category.software"),value:"software"},{title:l("searchEngine.filters.category.pictures"),value:"pictures"},{title:l("searchEngine.filters.category.books"),value:"books"}].sort((t,m)=>X.text.asc(t.title,m.title)).toSpliced(0,0,{title:l("searchEngine.filters.category.all"),value:"all"}),R=U(()=>[{title:l("searchEngine.filters.plugins.all"),value:"all"},{title:l("searchEngine.filters.plugins.enabled"),value:"enabled"},...c.searchPlugins.filter(t=>t.enabled).map(t=>t.name).sort(X.text.asc).map(t=>({title:t,value:t}))]),r=U(()=>d.value[b.value]??{}),{results:f}=xe(()=>r.value.results,()=>r.value.filters?.title,t=>t.fileName);function y(){c.createNewTab(),b.value=d.value.length-1,V.value?.focus()}function u(){d.value.length!==1&&(c.deleteTab(r.value.uniqueId),b.value=Math.min(b.value,d.value.length-1))}function B(t){o.usesQbit5?c.downloadTorrent(t.fileUrl,t.engineName):g.pushTorrentToQueue(t.fileUrl),t.downloaded=!0}function oe(t){Qe(t.descrLink)}async function K(){await c.runNewSearch(r.value),r.value.timer=setInterval(()=>ue(r.value),1e3),V.value?.saveValueToHistory()}async function L(t){await c.stopSearch(t),t.timer&&clearInterval(t.timer)}function re(){d.value.forEach(L)}async function ue(t){await c.refreshResults(t)==="Stopped"&&await L(t)}const O=()=>{k.push({name:"dashboard"})};function ce(){T.createDialog(ze)}function j(t){if(T.hasActiveDialog||I.value)return!1;t.key==="Escape"&&O()}return he(async()=>{document.addEventListener("keydown",j),d.value.length===0?c.createNewTab():d.value.forEach(t=>{t.id&&t.id!==0&&(t.timer=setInterval(()=>c.refreshResults(t),1e3))}),await c.fetchSearchPlugins()}),ve(()=>{document.removeEventListener("keydown",j),d.value.forEach(t=>{t.timer&&clearInterval(t.timer)})}),(t,m)=>(E(),A("div",Ke,[e(M,{"no-gutters":"",align:"center",justify:"center"},{default:a(()=>[e(N,null,{default:a(()=>[$("h1",Oe,p(s(l)("searchEngine.title")),1)]),_:1}),e(N,null,{default:a(()=>[$("div",je,[e(h,{icon:"mdi-stop",variant:"plain",color:"error",onClick:re}),e(h,{icon:"mdi-toy-brick",variant:"plain",color:"primary",onClick:ce}),e(h,{icon:"mdi-close",variant:"plain",onClick:O})])]),_:1})]),_:1}),e(M,{class:"ma-0 pa-0"},{default:a(()=>[e(Ie,{class:"d-flex align-center justify-center ma-0 pa-0 bg-primary",fluid:""},{default:a(()=>[e($e,{modelValue:b.value,"onUpdate:modelValue":m[0]||(m[0]=i=>b.value=i),class:"overflow-auto","bg-color":"primary","show-arrows":""},{default:a(()=>[(E(!0),A(ye,null,Se(s(d),i=>(E(),x(Me,{key:i.uniqueId},{default:a(()=>[$("h4",null,p(!i.lastQuery||i.lastQuery.length===0?s(l)("searchEngine.tabHeaderEmpty"):i.lastQuery),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(q),e(h,{icon:"mdi-plus-circle-outline",variant:"plain",color:"accent",onClick:y}),e(h,{icon:"mdi-minus-circle-outline",variant:"plain",color:"error",disabled:s(d).length===1,onClick:u},null,8,["disabled"])]),_:1})]),_:1}),e(De,null,{default:a(()=>[e(ee,null,{default:a(()=>[e(M,{class:"mt-1"},{default:a(()=>[e(N,{cols:"12",md:"6"},{default:a(()=>[e(Ue,{modelValue:r.value.query,"onUpdate:modelValue":m[1]||(m[1]=i=>r.value.query=i),"history-key":s(qe).SEARCH_ENGINE_QUERY,ref_key:"queryInput",ref:V,autofocus:"",density:"compact","hide-details":"",clearable:"",label:s(l)("searchEngine.query"),onKeydown:ke(F(K,["prevent"]),["enter"])},null,8,["modelValue","history-key","label","onKeydown"])]),_:1}),e(N,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(ae,{modelValue:r.value.filters.category,"onUpdate:modelValue":m[2]||(m[2]=i=>r.value.filters.category=i),height:"1",variant:"outlined",density:"compact","hide-details":"",items:s(v),label:s(l)("searchEngine.filters.category.label")},null,8,["modelValue","items","label"])]),_:1}),e(N,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(ae,{modelValue:r.value.filters.plugin,"onUpdate:modelValue":m[3]||(m[3]=i=>r.value.filters.plugin=i),flat:"",density:"compact","hide-details":"",variant:"outlined",items:R.value,label:s(l)("searchEngine.filters.plugins.label")},null,8,["modelValue","items","label"])]),_:1}),e(N,{cols:"12",sm:"2",class:"d-flex align-center justify-center"},{default:a(()=>[r.value.id===0?(E(),x(h,{key:0,color:"accent",flat:"",class:"mx-auto px-4",onClick:K},{default:a(()=>[_(p(s(l)("searchEngine.runSearch")),1)]),_:1})):(E(),x(h,{key:1,color:"warning",flat:"",class:"mx-auto px-4",onClick:m[4]||(m[4]=i=>L(r.value))},{default:a(()=>[_(p(s(l)("searchEngine.stopSearch")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(Re,{class:"my-3"}),e(ee,{class:"text-select"},{default:a(()=>[e(ie,{mobile:null,headers:n.value,items:s(f),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]},"items-per-page":r.value.itemsPerPage},{top:a(()=>[e(M,null,{default:a(()=>[e(N,{cols:"12"},{default:a(()=>[e(ne,{modelValue:r.value.filters.title,"onUpdate:modelValue":m[5]||(m[5]=i=>r.value.filters.title=i),density:"compact","hide-details":"",label:s(l)("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),"item.fileSize":a(({item:i})=>[_(p(s(Be)(i.fileSize,s(C))),1)]),"item.pubDate":a(({value:i})=>[_(p(i===-1?s(l)("common.NA"):s(Le)(i,s(D))),1)]),"item.actions":a(({item:i})=>[e(h,{icon:"mdi-open-in-new",variant:"flat",density:"compact",onClick:F(de=>oe(i),["stop"])},null,8,["onClick"]),e(h,{icon:i.downloaded?"mdi-check":"mdi-download",color:i.downloaded&&"accent",variant:"text",density:"compact",onClick:de=>B(i)},null,8,["icon","color","onClick"])]),_:2},1032,["headers","items","items-per-page"])]),_:1})]),_:1})]))}});export{Ye as default};

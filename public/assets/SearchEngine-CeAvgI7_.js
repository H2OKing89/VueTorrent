import{y as O,c as U,z as b,A as p,B as a,D as M,I as x,E as d,F as o,d as E,C as e,H as y,u as s,aj as L,a0 as ye,i as be,N as ke,x as Z,a7 as _e,_ as Ve,J as j,K as Ee,al as Se}from"./vue-BoVUvQ2U.js";import{a as we,b as Ce}from"./index-C6iEv0BH.js";import{h as de,e as g,j as F,V as ee,a as Ne,d as B,f as ae,b as le,k as Pe,i as H,c as te,L as K,q as Te,m as u,n as N,A as xe,R as De,S as $e,o as se,p as ne,r as ie,y as Ie}from"./vuetify-B4AYIWqO.js";import{a as Ue,u as me,j as oe,q as Me,V as Le,a0 as re,I as ue,a2 as Be}from"./composables-BW22VNGX.js";import{k as fe,e as Re,f as Ae,u as qe,a as ze}from"./stores-wQBBgkg3.js";const Qe={key:1,"data-testid":"mixedbtn-text"},ce=O({__name:"MixedButton",props:{mobileOverride:{type:Boolean,default:!1},mobileValue:{type:Boolean},position:{},icon:{},text:{}},setup(D){const w=D,{mobile:k}=de(),l=U(()=>w.mobileOverride?w.mobileValue:k.value);return(c,C)=>(p(),b(g,{icon:l.value},{default:a(()=>[l.value||c.position==="left"?(p(),b(F,{key:0,"data-testid":"mixedbtn-icon-left"},{default:a(()=>[d(o(c.icon),1)]),_:1})):M("",!0),l.value?M("",!0):(p(),x("span",Qe,o(c.text),1)),!l.value&&c.position==="right"?(p(),b(F,{key:2,"data-testid":"mixedbtn-icon-right"},{default:a(()=>[d(o(c.icon),1)]),_:1})):M("",!0)]),_:1},8,["icon"]))}}),je=["href","title"],Fe=O({__name:"PluginManagerDialog",props:{guid:{}},setup(D){const w=D,{isOpened:k}=Ue(w.guid),{t:l}=me(),c=fe(),C=[{title:l("dialogs.pluginManager.headers.enabled"),key:"enabled",sortable:!1},{title:l("dialogs.pluginManager.headers.name"),key:"fullName"},{title:l("dialogs.pluginManager.headers.version"),key:"version"},{title:l("dialogs.pluginManager.headers.url"),key:"url"},{title:l("dialogs.pluginManager.headers.actions"),key:"actions"}],_=E(!1),f=E(!1),v=E(!1),P=E(!1),S=E("");async function T(n){await c.toggleSearchPlugin(n),await c.fetchSearchPlugins()}async function R(){f.value=!0,await c.updatePlugins().then(()=>new Promise(n=>setTimeout(n,2e3))),await c.fetchSearchPlugins(),f.value=!1}async function V(){I(),_.value=!0,await c.installSearchPlugin(S.value),S.value="",setTimeout(()=>{c.fetchSearchPlugins().then(()=>{_.value=!1})},1e3)}async function $(n){_.value=!0,await c.uninstallSearchPlugin(n.name),await c.fetchSearchPlugins(),_.value=!1}const A=()=>{k.value=!1};function I(){v.value=!1}return(n,h)=>(p(),b(ae,{modelValue:s(k),"onUpdate:modelValue":h[4]||(h[4]=r=>be(k)?k.value=r:null)},{default:a(()=>[e(ee,null,{default:a(()=>[e(Ne,{class:"d-flex"},{default:a(()=>[y("div",null,o(n.$t("dialogs.pluginManager.title")),1),e(B),e(ce,{icon:"mdi-update",text:n.$t("dialogs.pluginManager.update"),color:"accent",class:"mr-2",loading:f.value,onClick:R},null,8,["text","loading"]),e(ae,{modelValue:v.value,"onUpdate:modelValue":h[3]||(h[3]=r=>v.value=r)},{activator:a(({props:r})=>[e(ce,ye({icon:"mdi-toy-brick-plus",text:n.$t("dialogs.pluginManager.install.activator")},r,{color:"primary"}),null,16,["text"])]),default:a(()=>[e(ee,{title:n.$t("dialogs.pluginManager.install.title")},{default:a(()=>[e(le,null,{default:a(()=>[e(s(Pe),{modelValue:P.value,"onUpdate:modelValue":h[1]||(h[1]=r=>P.value=r),onSubmit:h[2]||(h[2]=L(()=>{},["prevent"]))},{default:a(()=>[e(H,{modelValue:S.value,"onUpdate:modelValue":h[0]||(h[0]=r=>S.value=r),autofocus:"",label:n.$t("dialogs.pluginManager.install.label")},null,8,["modelValue","label"])]),_:1},8,["modelValue"])]),_:1}),e(te,null,{default:a(()=>[e(B),e(g,{color:"error",onClick:I},{default:a(()=>[d(o(n.$t("common.cancel")),1)]),_:1}),e(g,{color:"accent",onClick:V},{default:a(()=>[d(o(n.$t("common.ok")),1)]),_:1})]),_:1})]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1}),e(le,null,{default:a(()=>[e(K,{mobile:null,headers:C,"items-per-page":"-1",items:s(c).searchPlugins,"sort-by":[{key:"fullName",order:"asc"}],loading:_.value},{"item.enabled":a(({item:r})=>[e(Te,{"model-value":r.enabled,onClick:q=>T(r)},null,8,["model-value","onClick"])]),"item.url":a(({item:r})=>[y("a",{href:r.url,title:r.name},o(r.url),9,je)]),"item.actions":a(({item:r})=>[e(F,{color:"red",icon:"mdi-delete",onClick:q=>$(r)},null,8,["onClick"])]),_:2},1032,["items","loading"])]),_:1}),e(te,null,{default:a(()=>[e(B),e(g,{color:"accent",onClick:A},{default:a(()=>[d(o(n.$t("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),He={class:"pa-3"},Ke={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},Oe={class:"d-flex justify-end"},Ge={class:"item-header-small"},Je={class:"item-value-small"},Ye={class:"item-header-small"},We={class:"item-value-small"},Xe={class:"item-header-small"},Ze={class:"item-value-small"},ea=O({__name:"SearchEngine",setup(D){const{mobile:w}=de(),k=ke(),{t:l}=me(),c=Re(),C=Ae(),_=qe(),f=fe(),{searchData:v}=Z(f),{useBinarySize:P,dateFormat:S}=Z(ze()),T=E(),R=E(!1),V=E(0),$=U(()=>[{title:l("searchEngine.headers.fileName"),key:"fileName"},{title:l("searchEngine.headers.fileSize"),key:"fileSize"},{title:l("searchEngine.headers.nbSeeders"),key:"nbSeeders"},{title:l("searchEngine.headers.nbLeechers"),key:"nbLeechers"},...C.usesQbit5?[{title:l("searchEngine.headers.engineName"),key:"engineName"},{title:l("searchEngine.headers.pubDate"),key:"pubDate"}]:[{title:l("searchEngine.headers.siteUrl"),key:"siteUrl"}],{title:"",key:"actions",sortable:!1}]),A=[{title:l("searchEngine.filters.category.movies"),value:"movies"},{title:l("searchEngine.filters.category.tv"),value:"tv"},{title:l("searchEngine.filters.category.music"),value:"music"},{title:l("searchEngine.filters.category.games"),value:"games"},{title:l("searchEngine.filters.category.anime"),value:"anime"},{title:l("searchEngine.filters.category.software"),value:"software"},{title:l("searchEngine.filters.category.pictures"),value:"pictures"},{title:l("searchEngine.filters.category.books"),value:"books"}].sort((i,m)=>oe.text.asc(i.title,m.title)).toSpliced(0,0,{title:l("searchEngine.filters.category.all"),value:"all"}),I=U(()=>[{title:l("searchEngine.filters.plugins.all"),value:"all"},{title:l("searchEngine.filters.plugins.enabled"),value:"enabled"},...f.searchPlugins.filter(i=>i.enabled).map(i=>i.name).sort(oe.text.asc).map(i=>({title:i,value:i}))]),n=U(()=>v.value[V.value]??{}),{results:h}=Me(()=>n.value.results,()=>n.value.filters?.title,i=>i.fileName);function r(){f.createNewTab(),V.value=v.value.length-1,T.value?.focus()}function q(){v.value.length!==1&&(f.deleteTab(n.value.uniqueId),V.value=Math.min(V.value,v.value.length-1))}function G(i){C.usesQbit5?f.downloadTorrent(i.fileUrl,i.engineName):c.pushTorrentToQueue(i.fileUrl),i.downloaded=!0}function J(i){Be(i.descrLink)}async function Y(){await f.runNewSearch(n.value),n.value.timer=setInterval(()=>pe(n.value),1e3),T.value?.saveValueToHistory()}async function z(i){await f.stopSearch(i),i.timer&&clearInterval(i.timer)}function ge(){v.value.forEach(z)}async function pe(i){await f.refreshResults(i)==="Stopped"&&await z(i)}const W=()=>{k.push({name:"dashboard"})};function ve(){_.createDialog(Fe)}function X(i){if(_.hasActiveDialog||R.value)return!1;i.key==="Escape"&&W()}return _e(async()=>{document.addEventListener("keydown",X),v.value.length===0?f.createNewTab():v.value.forEach(i=>{i.id&&i.id!==0&&(i.timer=setInterval(()=>f.refreshResults(i),1e3))}),await f.fetchSearchPlugins()}),Ve(()=>{document.removeEventListener("keydown",X),v.value.forEach(i=>{i.timer&&clearInterval(i.timer)})}),(i,m)=>(p(),x("div",He,[e(N,{"no-gutters":"",align:"center",justify:"center"},{default:a(()=>[e(u,null,{default:a(()=>[y("h1",Ke,o(s(l)("searchEngine.title")),1)]),_:1}),e(u,null,{default:a(()=>[y("div",Oe,[e(g,{icon:"mdi-stop",variant:"plain",color:"error",onClick:ge}),e(g,{icon:"mdi-toy-brick",variant:"plain",color:"primary",onClick:ve}),e(g,{icon:"mdi-close",variant:"plain",onClick:W})])]),_:1})]),_:1}),e(N,{class:"ma-0 pa-0"},{default:a(()=>[e(xe,{class:"d-flex align-center justify-center ma-0 pa-0 bg-primary",fluid:""},{default:a(()=>[e(De,{modelValue:V.value,"onUpdate:modelValue":m[0]||(m[0]=t=>V.value=t),class:"overflow-auto","bg-color":"primary","show-arrows":""},{default:a(()=>[(p(!0),x(j,null,Ee(s(v),t=>(p(),b($e,{key:t.uniqueId},{default:a(()=>[y("h4",null,o(!t.lastQuery||t.lastQuery.length===0?s(l)("searchEngine.tabHeaderEmpty"):t.lastQuery),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]),e(B),e(g,{icon:"mdi-plus-circle-outline",variant:"plain",color:"accent",onClick:r}),e(g,{icon:"mdi-minus-circle-outline",variant:"plain",color:"error",disabled:s(v).length===1,onClick:q},null,8,["disabled"])]),_:1})]),_:1}),e(Ie,null,{default:a(()=>[e(se,null,{default:a(()=>[e(N,{class:"mt-1"},{default:a(()=>[e(u,{cols:"12",md:"6"},{default:a(()=>[e(we,{modelValue:n.value.query,"onUpdate:modelValue":m[1]||(m[1]=t=>n.value.query=t),"history-key":s(Le).SEARCH_ENGINE_QUERY,ref_key:"queryInput",ref:T,autofocus:"",density:"compact","hide-details":"",clearable:"",label:s(l)("searchEngine.query"),onKeydown:Se(L(Y,["prevent"]),["enter"])},null,8,["modelValue","history-key","label","onKeydown"])]),_:1}),e(u,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(ne,{modelValue:n.value.filters.category,"onUpdate:modelValue":m[2]||(m[2]=t=>n.value.filters.category=t),height:"1",variant:"outlined",density:"compact","hide-details":"",items:s(A),label:s(l)("searchEngine.filters.category.label")},null,8,["modelValue","items","label"])]),_:1}),e(u,{cols:"6",sm:"5",md:"2"},{default:a(()=>[e(ne,{modelValue:n.value.filters.plugin,"onUpdate:modelValue":m[3]||(m[3]=t=>n.value.filters.plugin=t),flat:"",density:"compact","hide-details":"",variant:"outlined",items:I.value,label:s(l)("searchEngine.filters.plugins.label")},null,8,["modelValue","items","label"])]),_:1}),e(u,{cols:"12",sm:"2",class:"d-flex align-center justify-center"},{default:a(()=>[n.value.id===0?(p(),b(g,{key:0,color:"accent",flat:"",class:"mx-auto px-4",onClick:Y},{default:a(()=>[d(o(s(l)("searchEngine.runSearch")),1)]),_:1})):(p(),b(g,{key:1,color:"warning",flat:"",class:"mx-auto px-4",onClick:m[4]||(m[4]=t=>z(n.value))},{default:a(()=>[d(o(s(l)("searchEngine.stopSearch")),1)]),_:1}))]),_:1})]),_:1})]),_:1}),e(ie,{class:"my-3"}),e(se,{class:"text-select"},{default:a(()=>[s(w)?(p(),b(K,{key:0,mobile:!0,headers:$.value,items:s(h),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]},"items-per-page":n.value.itemsPerPage},{top:a(()=>[e(N,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(H,{modelValue:n.value.filters.title,"onUpdate:modelValue":m[5]||(m[5]=t=>n.value.filters.title=t),density:"compact","hide-details":"",label:s(l)("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),item:a(({item:t,index:Q})=>[Q!==0?(p(),b(ie,{key:0})):M("",!0),e(N,{class:"row-mobile ma-0 pa-3"},{default:a(()=>[e(u,{cols:"6",class:"item-header-large"},{default:a(()=>[d(o(s(l)("searchEngine.headers.fileName")),1)]),_:1}),e(u,{cols:"6",class:"item-value-large"},{default:a(()=>[d(o(t.fileName),1)]),_:2},1024),s(C).usesQbit5?(p(),x(j,{key:0},[e(u,{cols:"6",class:"item-header-large"},{default:a(()=>[d(o(s(l)("searchEngine.headers.engineName")),1)]),_:1}),e(u,{cols:"6",class:"item-value-large"},{default:a(()=>[d(o(t.engineName),1)]),_:2},1024),e(u,{cols:"6",class:"item-header-large"},{default:a(()=>[d(o(s(l)("searchEngine.headers.pubDate")),1)]),_:1}),e(u,{cols:"6",class:"item-value-large"},{default:a(()=>[d(o(t.pubDate===-1?s(l)("common.NA"):s(re)(t.pubDate,s(S))),1)]),_:2},1024)],64)):(p(),x(j,{key:1},[e(u,{cols:"6",class:"item-header-large"},{default:a(()=>[d(o(s(l)("searchEngine.headers.siteUrl")),1)]),_:1}),e(u,{cols:"6",class:"item-value-large"},{default:a(()=>[d(o(t.siteUrl),1)]),_:2},1024)],64)),e(u,{cols:"3",class:"item-container"},{default:a(()=>[y("div",Ge,o(s(l)("searchEngine.headers.fileSize")),1),y("div",Je,o(s(ue)(t.fileSize,s(P))),1)]),_:2},1024),e(u,{cols:"3",class:"item-container"},{default:a(()=>[y("div",Ye,o(s(l)("searchEngine.headers.nbSeeders")),1),y("div",We,o(t.nbSeeders),1)]),_:2},1024),e(u,{cols:"3",class:"item-container"},{default:a(()=>[y("div",Xe,o(s(l)("searchEngine.headers.nbLeechers")),1),y("div",Ze,o(t.nbLeechers),1)]),_:2},1024),e(u,{cols:"3",class:"item-actions"},{default:a(()=>[e(g,{icon:"mdi-open-in-new",variant:"flat",density:"compact",onClick:L(he=>J(t),["stop"])},null,8,["onClick"]),e(g,{icon:t.downloaded?"mdi-check":"mdi-download",color:t.downloaded&&"accent",variant:"text",density:"compact",onClick:he=>G(t)},null,8,["icon","color","onClick"])]),_:2},1024)]),_:2},1024)]),_:1},8,["headers","items","items-per-page"])):(p(),b(K,{key:1,mobile:!1,headers:$.value,items:s(h),"footer-props":{itemsPerPageOptions:[10,25,50,100,-1]},"items-per-page":n.value.itemsPerPage},{top:a(()=>[e(N,null,{default:a(()=>[e(u,{cols:"12"},{default:a(()=>[e(H,{modelValue:n.value.filters.title,"onUpdate:modelValue":m[6]||(m[6]=t=>n.value.filters.title=t),density:"compact","hide-details":"",label:s(l)("searchEngine.filters.title.label")},null,8,["modelValue","label"])]),_:1})]),_:1})]),"item.fileSize":a(({item:t})=>[d(o(s(ue)(t.fileSize,s(P))),1)]),"item.pubDate":a(({value:t})=>[d(o(t===-1?s(l)("common.NA"):s(re)(t,s(S))),1)]),"item.actions":a(({item:t})=>[e(g,{icon:"mdi-open-in-new",variant:"flat",density:"compact",onClick:L(Q=>J(t),["stop"])},null,8,["onClick"]),e(g,{icon:t.downloaded?"mdi-check":"mdi-download",color:t.downloaded&&"accent",variant:"text",density:"compact",onClick:Q=>G(t)},null,8,["icon","color","onClick"])]),_:2},1032,["headers","items","items-per-page"]))]),_:1})]),_:1})]))}}),ia=Ce(ea,[["__scopeId","data-v-62d82f7b"]]);export{ia as default};

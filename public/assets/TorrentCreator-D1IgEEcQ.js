import{a5 as ve,b as B,f as te,a2 as _e,a3 as Se,J as c,u as a,K as d,r as he,e as Q,M as e,n as t,P as p,Q as u,S as W,T as M,U as F,F as I,V as Te,W as Fe,X as xe,O as we,z as Le,y as b,Z as ne,v as ie,q as ze}from"./vue-BhpnMDi9.js";import{p as De}from"./purify.es-CEVJ7K31.js";import{a8 as P,P as ae,ag as Ue,ah as Ie,V as ce,h as Pe,e as pe,ai as w,ac as fe,i as N,j as K,aj as J,ak as X,p as _,k as Z,x as ke,w as V,B as O,z as de,al as j,am as H,n as Ae,q as ee,O as Ee,t as He,an as Re,v as Me,ao as L,y as R,o as q,G as Y,a as z,H as G,ap as ue,aq as Ne,ar as Be,as as Oe}from"./index-v0FNZJhk.js";import{V as $e}from"./VForm-OSQFNdOr.js";import{V as je}from"./VEmptyState-bIYYO6l_.js";import{V as qe}from"./VDataTable-C1EgDeRi.js";import{d as Ye}from"./vuetify-C3rKtZyf.js";import"./VPagination-CQEZmux6.js";var Ve=(g=>(g.ALL="all",g.ONLY_FILES="files",g.ONLY_DIRECTORIES="dirs",g))(Ve||{});const be=ve("torrentCreator",()=>{const g=B([]);async function S(){g.value=await P.getTorrentCreatorStatus()}async function y(f){return await P.addTorrentCreatorTask(f)}async function o(f){return await P.deleteTorrentCreatorTask(f)}async function h(f){return await P.getTorrentCreatorOutput(f)}return{tasks:g,fetchTasks:S,createTask:y,deleteTask:o,downloadTorrent:h}}),me=te({__name:"ServerPathField",props:_e({title:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(g){const S=Se(g,"modelValue"),y=B([]),o=ae(),h=Ie(async f=>{if(!f)return;const k=await P.getDirectoryContent(f,Ve.ALL);k&&(y.value=k)},500);return(f,k)=>a(o).usesQbit5?(d(),c(Ue,{key:0,modelValue:S.value,"onUpdate:modelValue":k[0]||(k[0]=v=>S.value=v),items:y.value,label:f.title,"onUpdate:search":a(h)},null,8,["modelValue","items","label","onUpdate:search"])):(d(),c(ce,{key:1,modelValue:S.value,"onUpdate:modelValue":k[1]||(k[1]=v=>S.value=v),label:f.title},null,8,["modelValue","label"]))}}),Ge=te({__name:"TorrentCreatorFormDialog",props:{guid:{}},setup(g){const S=g,{isOpened:y}=Pe(S.guid),{t:o}=pe(),h=ae(),f=be(),k=B(),v=B(!1),n=he({sourcePath:"",format:w.HYBRID,pieceSize:0,optimizeAlignment:!1,paddedFileSizeLimit:0,private:!1,startSeeding:!1,torrentFilePath:"",trackers:"",urlSeeds:"",source:"",comment:""}),A=[{title:o("constants.torrentFormat.v1"),value:w.V1},{title:o("constants.torrentFormat.v2"),value:w.V2},{title:o("constants.torrentFormat.hybrid"),value:w.HYBRID}],D=Q(()=>{const T=[{title:o("common.auto"),value:0}];for(let l=16*1024;l<5e8;l*=2)T.push({title:fe(l,!0,0),value:l});return T}),$=[T=>!T||T<-1||o("dialogs.torrentCreator.paddedFileSizeLimitRule")];async function E(){v.value&&(await f.createTask(n),U())}function U(){y.value=!1}return(T,l)=>(d(),c(ee,{modelValue:a(y),"onUpdate:modelValue":l[14]||(l[14]=s=>Te(y)?y.value=s:null),"max-width":"1250"},{default:e(()=>[t(N,null,{default:e(()=>[t(K,{class:"ios-margin"},{default:e(()=>[t(J,{color:"transparent"},{default:e(()=>[t(X,null,{default:e(()=>[p(u(a(o)("dialogs.torrentCreator.title")),1)]),_:1}),t(_,{icon:"mdi-close",onClick:U})]),_:1})]),_:1}),t(Z,null,{default:e(()=>[t(a($e),{ref_key:"form",ref:k,modelValue:v.value,"onUpdate:modelValue":l[12]||(l[12]=s=>v.value=s),onSubmit:l[13]||(l[13]=W(()=>{},["prevent"]))},{default:e(()=>[t(ke,null,{default:e(()=>[t(V,{cols:"12"},{default:e(()=>[t(me,{modelValue:n.sourcePath,"onUpdate:modelValue":l[0]||(l[0]=s=>n.sourcePath=s),title:a(o)("dialogs.torrentCreator.sourcePath"),rules:[s=>!!s||a(o)("dialogs.torrentCreator.rules.sourcePathRequired")]},null,8,["modelValue","title","rules"])]),_:1}),t(V,{cols:"12"},{default:e(()=>[t(me,{modelValue:n.torrentFilePath,"onUpdate:modelValue":l[1]||(l[1]=s=>n.torrentFilePath=s),title:a(o)("dialogs.torrentCreator.torrentFilePath"),rules:[s=>!s||s.endsWith(".torrent")||a(o)("dialogs.torrentCreator.rules.outputFileExtension")]},null,8,["modelValue","title","rules"])]),_:1}),t(O),a(h).usesLibtorrent2?(d(),c(V,{key:0,cols:"12",sm:"6",class:"pb-0"},{default:e(()=>[t(de,{modelValue:n.format,"onUpdate:modelValue":l[2]||(l[2]=s=>n.format=s),"hide-details":"",items:A,label:a(o)("dialogs.torrentCreator.format")},null,8,["modelValue","label"])]),_:1})):M("",!0),t(V,{cols:"12",sm:a(h).usesLibtorrent2?6:void 0,class:"pb-0"},{default:e(()=>[t(de,{modelValue:n.pieceSize,"onUpdate:modelValue":l[3]||(l[3]=s=>n.pieceSize=s),"hide-details":"",items:D.value,label:a(o)("dialogs.torrentCreator.pieceSize")},null,8,["modelValue","items","label"])]),_:1},8,["sm"]),a(h).usesLibtorrent1?(d(),F(I,{key:1},[t(V,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(j,{modelValue:n.optimizeAlignment,"onUpdate:modelValue":l[4]||(l[4]=s=>n.optimizeAlignment=s),"hide-details":"",label:a(o)("dialogs.torrentCreator.optimizeAlignment")},null,8,["modelValue","label"])]),_:1}),t(V,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(ce,{modelValue:n.paddedFileSizeLimit,"onUpdate:modelValue":l[5]||(l[5]=s=>n.paddedFileSizeLimit=s),modelModifiers:{number:!0},min:"-1",rules:$,label:a(o)("dialogs.torrentCreator.paddedFileSizeLimit"),hint:a(o)("dialogs.torrentCreator.paddedFileSizeLimitHint"),suffix:"kiB"},null,8,["modelValue","label","hint"])]),_:1})],64)):M("",!0),t(V,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(j,{modelValue:n.private,"onUpdate:modelValue":l[6]||(l[6]=s=>n.private=s),"hide-details":"",label:a(o)("dialogs.torrentCreator.private")},null,8,["modelValue","label"])]),_:1}),t(V,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(j,{modelValue:n.startSeeding,"onUpdate:modelValue":l[7]||(l[7]=s=>n.startSeeding=s),"hide-details":"",label:a(o)("dialogs.torrentCreator.startSeeding")},null,8,["modelValue","label"])]),_:1}),t(O),t(V,{cols:"12"},{default:e(()=>[t(H,{modelValue:n.trackers,"onUpdate:modelValue":l[8]||(l[8]=s=>n.trackers=s),label:a(o)("dialogs.torrentCreator.trackers"),hint:a(o)("dialogs.torrentCreator.trackersHint")},null,8,["modelValue","label","hint"])]),_:1}),t(V,{cols:"12"},{default:e(()=>[t(H,{modelValue:n.urlSeeds,"onUpdate:modelValue":l[9]||(l[9]=s=>n.urlSeeds=s),"hide-details":"",label:a(o)("dialogs.torrentCreator.urlSeeds")},null,8,["modelValue","label"])]),_:1}),a(h).isFeatureAvailable("5.1.0")?(d(),c(V,{key:2,cols:"12"},{default:e(()=>[t(H,{modelValue:n.source,"onUpdate:modelValue":l[10]||(l[10]=s=>n.source=s),"hide-details":"",label:a(o)("dialogs.torrentCreator.source")},null,8,["modelValue","label"])]),_:1})):M("",!0),t(V,{cols:"12"},{default:e(()=>[t(H,{modelValue:n.comment,"onUpdate:modelValue":l[11]||(l[11]=s=>n.comment=s),"hide-details":"",label:a(o)("dialogs.torrentCreator.comment")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(Ae,null,{default:e(()=>[t(_,{disabled:!v.value,color:"accent",onClick:E},{default:e(()=>[p(u(a(o)("dialogs.torrentCreator.actions.submit")),1)]),_:1},8,["disabled"]),t(_,{color:"error",onClick:U},{default:e(()=>[p(u(a(o)("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Qe={class:"pa-3"},We={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},Ke={class:"d-flex justify-end"},Je={class:"d-flex align-center flex-gap"},Xe={class:"text-no-wrap"},Ze={class:"text-no-wrap"},et={class:"text-no-wrap"},tt={class:"text-no-wrap"},at={key:1},ot={class:"text-no-wrap"},rt={key:1},lt=["innerHTML"],st=["innerHTML"],kt=te({__name:"TorrentCreator",setup(g){const{height:S}=Ye(),y=Fe(),{t:o}=pe(),h=ae(),f=Ee(),k=be(),{tasks:v}=xe(k),n=He(),A=Re(function*(){yield k.fetchTasks()}).drop(),{isActive:D,pause:$,resume:E}=Me(()=>void A.perform(),1e3,{immediate:!0,immediateCallback:!0}),U=E,T=Q(()=>S.value-64-12*2-48),l=Q(()=>[{key:"actions",sortable:!1},{title:o("torrentCreator.table.sourcePath"),key:"sourcePath"},{title:o("torrentCreator.table.status"),key:"status"},{title:o("torrentCreator.table.progress"),key:"progress"},h.usesLibtorrent2?{title:o("torrentCreator.table.format"),key:"format"}:{title:o("torrentCreator.table.optimizeAlignment"),key:"optimizeAlignment"},{title:o("torrentCreator.table.pieceSize"),key:"pieceSize"},{title:o("torrentCreator.table.private"),key:"private"},{title:o("torrentCreator.table.timeAdded"),key:"timeAdded"},{title:o("torrentCreator.table.timeStarted"),key:"timeStarted"},{title:o("torrentCreator.table.timeFinished"),key:"timeFinished"},{title:o("torrentCreator.table.trackers.header"),key:"trackers",sortable:!1},{title:o("torrentCreator.table.urlSeeds.header"),key:"urlSeeds",sortable:!1},{title:o("torrentCreator.table.source"),key:"source"},{title:o("torrentCreator.table.comment"),key:"comment"},{title:o("torrentCreator.table.errorMessage"),key:"errorMessage"}]),s={[L.FAILED]:"error",[L.RUNNING]:"torrent-ul_stalled",[L.QUEUED]:"warning",[L.FINISHED]:"success"},ge={[w.V1]:"V1",[w.V2]:"V2",[w.HYBRID]:"Hybrid"};function oe(){f.createDialog(Ge,{},()=>void k.fetchTasks())}async function Ce(C){const m=await k.downloadTorrent(C.taskID),r=Be(C.torrentFilePath);let i;r&&r.endsWith(".torrent")?i=r.slice(0,-8):r?i=r:i=C.taskID,Oe(`${i}.torrent`,m)}async function ye(C){await k.deleteTask(C.taskID),U()}function re(C){return C?.length?De.sanitize(C,{USE_PROFILES:{html:!0}}).replaceAll(`
`,"<br>"):""}function le(){y.push({name:"dashboard"})}function se(C){if(f.hasActiveDialog)return!1;C.key==="Escape"&&(C.preventDefault(),le())}return we(()=>{document.addEventListener("keydown",se),A.perform()}),Le(()=>{document.removeEventListener("keydown",se)}),(C,m)=>(d(),F("div",Qe,[t(ke,{"no-gutters":"",align:"center",justify:"center"},{default:e(()=>[t(V,null,{default:e(()=>[b("h1",We,u(a(o)("torrentCreator.title")),1)]),_:1}),t(V,null,{default:e(()=>[b("div",Ke,[t(_,{icon:"mdi-close",variant:"plain",onClick:le})])]),_:1})]),_:1}),a(v).length?(d(),c(Y,{key:1},{default:e(()=>[t(R,null,{default:e(()=>[b("div",Je,[t(q),t(_,{color:"accent","prepend-icon":a(D)?"mdi-timer-pause":"mdi-timer-play",text:a(D)?a(o)("common.pause"):a(o)("common.resume"),onClick:m[1]||(m[1]=r=>a(D)?a($)():a(E)())},null,8,["prepend-icon","text"]),t(_,{color:"accent","prepend-icon":"mdi-plus",text:a(o)("torrentCreator.table.create"),onClick:oe},null,8,["text"])])]),_:1}),t(O,{class:"my-3"}),t(R,{class:"text-select"},{default:e(()=>[t(qe,{"header-props":{class:"text-no-wrap"},mobile:null,headers:l.value,items:a(v),"multi-sort":"","footer-props":{itemsPerPageOptions:[10,25,50,100,-1]}},{"item.status":e(({item:r,value:i})=>[b("span",{class:ze(`text-${s[r.status]}`)},u(a(o)(`constants.torrentCreatorTaskStatus.${i.toLowerCase()}`)),3)]),"item.progress":e(({item:r,value:i})=>[r.status===a(L).RUNNING?(d(),c(ue,{key:0,"model-value":i,color:s[r.status],height:20,rounded:"sm",style:{width:"10em"}},{default:e(()=>[p(u(i)+" % ",1)]),_:2},1032,["model-value","color"])):(d(),c(ue,{key:1,"model-value":100,color:s[r.status],height:20,rounded:"sm",style:{width:"10em"}},{default:e(()=>[p(u(a(Ne)(1)),1)]),_:2},1032,["color"]))]),"item.format":e(({value:r})=>[p(u(ge[r]),1)]),"item.pieceSize":e(({value:r})=>[p(u(a(fe)(r,a(n).useBinarySize,0)),1)]),"item.private":e(({value:r})=>[r?(d(),c(z,{key:0,color:"accent"},{default:e(()=>m[2]||(m[2]=[p(" mdi-check-bold ",-1)])),_:1,__:[2]})):(d(),c(z,{key:1,color:"error"},{default:e(()=>m[3]||(m[3]=[p(" mdi-close-thick ",-1)])),_:1,__:[3]}))]),"item.optimizeAlignment":e(({value:r})=>[r?(d(),c(z,{key:0,color:"accent"},{default:e(()=>m[4]||(m[4]=[p(" mdi-check-bold ",-1)])),_:1,__:[4]})):(d(),c(z,{key:1,color:"error"},{default:e(()=>m[5]||(m[5]=[p(" mdi-close-thick ",-1)])),_:1,__:[5]}))]),"item.timeAdded":e(({value:r})=>[b("div",Xe,u(a(G)(r).format(a(n).dateFormat)),1)]),"item.timeFinished":e(({value:r})=>[b("div",Ze,u(a(G)(r).format(a(n).dateFormat)),1)]),"item.timeStarted":e(({value:r})=>[b("div",et,u(a(G)(r).format(a(n).dateFormat)),1)]),"item.trackers":e(({value:r})=>[r&&r.length&&!r.every(i=>!i.length)?(d(),c(ee,{key:0},{activator:e(({props:i})=>[b("div",tt,[b("span",null,u(a(o)("torrentCreator.table.trackers.activator",r.filter(x=>x.length).length)),1),t(z,ie({class:"ml-1"},i),{default:e(()=>m[6]||(m[6]=[p(" mdi-information ",-1)])),_:2,__:[6]},1040)])]),default:e(()=>[t(N,null,{default:e(()=>[t(K,{class:"ios-margin"},{default:e(()=>[t(J,{color:"transparent"},{default:e(()=>[t(X,null,{default:e(()=>[p(u(a(o)("torrentCreator.table.trackers.title")),1)]),_:1}),t(q),t(_,{icon:"mdi-close"})]),_:1})]),_:1}),t(Z,null,{default:e(()=>[t(Y,null,{default:e(()=>[(d(!0),F(I,null,ne(r,(i,x)=>(d(),F(I,{key:x},[i?(d(),c(R,{key:0},{default:e(()=>[p(u(i),1)]),_:2},1024)):(d(),c(O,{key:1}))],64))),128))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):(d(),F("span",at,u(a(o)("common.none")),1))]),"item.urlSeeds":e(({value:r})=>[r&&r.length&&!r.every(i=>!i.length)?(d(),c(ee,{key:0},{activator:e(({props:i})=>[b("div",ot,[b("span",null,u(a(o)("torrentCreator.table.urlSeeds.activator",r.filter(x=>x.length).length)),1),t(z,ie({class:"ml-1"},i),{default:e(()=>m[7]||(m[7]=[p(" mdi-information ",-1)])),_:2,__:[7]},1040)])]),default:e(()=>[t(N,null,{default:e(()=>[t(K,{class:"ios-margin"},{default:e(()=>[t(J,{color:"transparent"},{default:e(()=>[t(X,null,{default:e(()=>[p(u(a(o)("torrentCreator.table.urlSeeds.title")),1)]),_:1}),t(q),t(_,{icon:"mdi-close"})]),_:1})]),_:1}),t(Z,null,{default:e(()=>[t(Y,null,{default:e(()=>[(d(!0),F(I,null,ne(r.filter(i=>i.length),(i,x)=>(d(),F(I,null,[i?(d(),c(R,{key:x},{default:e(()=>[p(u(i),1)]),_:2},1024)):M("",!0)],64))),256))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):(d(),F("span",rt,u(a(o)("common.none")),1))]),"item.comment":e(({value:r})=>[b("div",{class:"text-no-wrap",innerHTML:re(r)},null,8,lt)]),"item.errorMessage":e(({value:r})=>[b("div",{class:"text-no-wrap",innerHTML:re(r)},null,8,st)]),"item.actions":e(({item:r})=>[t(_,{disabled:r.status!==a(L).FINISHED,color:"accent",icon:"mdi-download",variant:"text",density:"compact",onClick:W(i=>Ce(r),["stop"])},null,8,["disabled","onClick"]),t(_,{color:"red",icon:"mdi-delete",variant:"text",density:"compact",onClick:W(i=>ye(r),["stop"])},null,8,["onClick"])]),_:2},1032,["headers","items"])]),_:1})]),_:1})):(d(),c(N,{key:0,height:T.value},{default:e(()=>[t(je,{title:a(o)("torrentCreator.empty.value"),color:"accent",icon:"mdi-cog-off"},{actions:e(()=>[t(_,{text:a(o)("torrentCreator.empty.action"),color:"accent",onClick:m[0]||(m[0]=r=>oe())},null,8,["text"])]),_:1},8,["title"])]),_:1},8,["height"]))]))}});export{kt as default};

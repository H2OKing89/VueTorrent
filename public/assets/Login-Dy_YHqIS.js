import{f as v,U as b,Z as C,r as q,b as h,G as k,w as x,I as S,J as K,L as o,m as e,N as m,O as p,u,Q as f,P as _,_ as y}from"./vue-D52l2THz.js";import{_ as U}from"./PasswordField.vue_vue_type_script_setup_true_lang-CzrwHo04.js";import{u as A,G as I,d as T,e as B,H as F,f as N,g as O,V as $,a as E,i as G,k as L,I as M}from"./index-Dbaoqj3v.js";import"./vuetify-CWphNKul.js";const Q=v({__name:"Login",setup(R){const{t:s}=A(),w=b(),t=C(),i=I(),n=q({username:"",password:""}),c=h(!1),V={username:[r=>!!r||s("login.rules.username_required")],password:[r=>!!r||s("login.rules.password_required")]};async function d(){if(!c.value)return;const r=await i.login(n.username,n.password);if(i.isAuthenticated)y.success(s("login.success")),g();else{let a=s("login.error");r.status!==200&&(a+=`
Error code: ${r.status} (${r.data})`),y.error(a)}}function g(){t.query.redirect?w.push(t.query.redirect):w.push({name:"dashboard"})}return k(async()=>{t.query.username&&t.query.password&&await i.login(t.query.username,t.query.password)}),x(()=>{i.isAuthenticated&&g()}),(r,a)=>(K(),S(M,{class:"fill-height"},{default:o(()=>[e(T,{class:"mx-auto",rounded:"lg","min-width":"250"},{default:o(()=>[e(B,null,{default:o(()=>[m(p(u(s)("login.title")),1)]),_:1}),e(F,null,{default:o(()=>[m(p(u(s)("login.subtitle")),1)]),_:1}),e(N,null,{default:o(()=>[e(O,{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=l=>c.value=l),onSubmit:f(d,["prevent"])},{default:o(()=>[e($,{id:"username",modelValue:n.username,"onUpdate:modelValue":a[0]||(a[0]=l=>n.username=l),name:"username",label:u(s)("login.username"),autofocus:"",rules:V.username,variant:"outlined",onKeydown:_(f(d,["prevent"]),["enter"])},{prepend:o(()=>[e(E,{color:"accent",icon:"mdi-account"})]),_:1},8,["modelValue","label","rules","onKeydown"]),e(U,{id:"password",modelValue:n.password,"onUpdate:modelValue":a[1]||(a[1]=l=>n.password=l),label:u(s)("login.password"),rules:V.password,"prepend-icon":"mdi-lock",variant:"outlined",onKeydown:_(f(d,["prevent"]),["enter"])},null,8,["modelValue","label","rules","onKeydown"])]),_:1},8,["modelValue"])]),_:1}),e(G,null,{default:o(()=>[e(L,{variant:"elevated",block:"",color:"accent",onClick:d},{default:o(()=>[m(p(u(s)("login.submit")),1)]),_:1})]),_:1})]),_:1})]),_:1}))}});export{Q as default};

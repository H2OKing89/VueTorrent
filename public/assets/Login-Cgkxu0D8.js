import{x as b,M as v,N as C,m as k,d as q,n as x,k as h,y as A,z as S,A as o,B as e,D as c,E as p,u,aj as f,al as _,R as y}from"./vue-POwbTJ1u.js";import{_ as K}from"./PasswordField.vue_vue_type_script_setup_true_lang-fs-K8Xe0.js";import{f as B}from"./stores-CVPgn2b-.js";import{u as T}from"./composables-UoHeEaP2.js";import{V as U,a as E,z as F,b as M,k as N,i as R,j as $,c as j,e as z,A as D}from"./vuetify-NcYkVwk0.js";const P=b({__name:"Login",setup(I){const{t:s}=T(),w=v(),t=C(),i=B(),n=k({username:"",password:""}),m=q(!1),V={username:[r=>!!r||s("login.rules.username_required")],password:[r=>!!r||s("login.rules.password_required")]},d=async()=>{if(!m.value)return;const r=await i.login(n.username,n.password);if(i.isAuthenticated)y.success(s("login.success")),g();else{let a=s("login.error");r.status!==200&&(a+=`
Error code: ${r.status} (${r.data})`),y.error(a)}},g=()=>{t.query.redirect?w.push(t.query.redirect):w.push({name:"dashboard"})};return x(async()=>{t.query.username&&t.query.password&&await i.login(t.query.username,t.query.password)}),h(()=>{i.isAuthenticated&&g()}),(r,a)=>(S(),A(D,{class:"fill-height"},{default:o(()=>[e(U,{class:"mx-auto",rounded:"lg","min-width":"250"},{default:o(()=>[e(E,null,{default:o(()=>[c(p(u(s)("login.title")),1)]),_:1}),e(F,null,{default:o(()=>[c(p(u(s)("login.subtitle")),1)]),_:1}),e(M,null,{default:o(()=>[e(N,{modelValue:m.value,"onUpdate:modelValue":a[2]||(a[2]=l=>m.value=l),onSubmit:f(d,["prevent"])},{default:o(()=>[e(R,{modelValue:n.username,"onUpdate:modelValue":a[0]||(a[0]=l=>n.username=l),id:"username",name:"username",label:u(s)("login.username"),autofocus:"",rules:V.username,onKeydown:_(f(d,["prevent"]),["enter"]),variant:"outlined"},{prepend:o(()=>[e($,{color:"accent",icon:"mdi-account"})]),_:1},8,["modelValue","label","rules","onKeydown"]),e(K,{modelValue:n.password,"onUpdate:modelValue":a[1]||(a[1]=l=>n.password=l),id:"password",label:u(s)("login.password"),rules:V.password,"prepend-icon":"mdi-lock",onKeydown:_(f(d,["prevent"]),["enter"]),variant:"outlined"},null,8,["modelValue","label","rules","onKeydown"])]),_:1},8,["modelValue"])]),_:1}),e(j,null,{default:o(()=>[e(z,{variant:"elevated",block:"",color:"accent",onClick:d},{default:o(()=>[c(p(u(s)("login.submit")),1)]),_:1})]),_:1})]),_:1})]),_:1}))}});export{P as default};

import{x as ee,ao as ge,ap as Ce,d as q,y as c,u as l,z as d,m as ye,c as G,A as e,B as t,D as p,E as u,aj as W,C as H,H as F,I as L,i as ve,M as Se,v as _e,P as he,a7 as Fe,_ as xe,G as b,J as re,a0 as se,an as Te}from"./vue-POwbTJ1u.js";import{W as De,X as we,a as ze,u as ue,f as x,I as me,D as Le,e as T,O as $,Y as Ue,Z as Ae,_ as Ie}from"./composables-UoHeEaP2.js";import{f as te,q as Pe,h as ce,u as Me,a as He}from"./stores-CVPgn2b-.js";import{H as Be,i as pe,V as B,a as J,B as K,C as Q,e as g,b as X,k as Ee,n as fe,m as V,r as E,p as ne,I as j,J as P,c as Ne,f as Z,h as Re,K as $e,o as M,d as O,L as je,y as Y,j as D,M as ie}from"./vuetify-NcYkVwk0.js";const de=ee({__name:"ServerPathField",props:ge({title:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(U){const S=Ce(U,"modelValue"),y=q([]),o=te(),_=De(async C=>{if(!C)return;const f=await Pe.getDirectoryContent(C,we.ALL);f&&(y.value=f)},500);return(C,f)=>l(o).usesQbit5?(d(),c(Be,{key:0,modelValue:S.value,"onUpdate:modelValue":f[0]||(f[0]=k=>S.value=k),items:y.value,label:C.title,"onUpdate:search":l(_)},null,8,["modelValue","items","label","onUpdate:search"])):(d(),c(pe,{key:1,modelValue:S.value,"onUpdate:modelValue":f[1]||(f[1]=k=>S.value=k),label:C.title},null,8,["modelValue","label"]))}}),Oe=ee({__name:"TorrentCreatorFormDialog",props:{guid:{}},setup(U){const S=U,{isOpened:y}=ze(S.guid),{t:o}=ue(),_=te(),C=ce(),f=q(),k=q(!1),n=ye({sourcePath:"",format:x.HYBRID,pieceSize:0,optimizeAlignment:!1,paddedFileSizeLimit:0,private:!1,startSeeding:!1,torrentFilePath:"",trackers:"",urlSeeds:"",source:"",comment:""}),A=[{title:o("constants.torrentFormat.v1"),value:x.V1},{title:o("constants.torrentFormat.v2"),value:x.V2},{title:o("constants.torrentFormat.hybrid"),value:x.HYBRID}],w=G(()=>{const h=[{title:o("common.auto"),value:0}];for(let r=16*1024;r<5e8;r*=2)h.push({title:me(r,!0,0),value:r});return h}),N=[h=>!h||h<-1||o("dialogs.torrentCreator.paddedFileSizeLimitRule")];async function I(){k.value&&(await C.createTask(n),z())}const z=()=>{y.value=!1};return(h,r)=>(d(),c(Z,{modelValue:l(y),"onUpdate:modelValue":r[14]||(r[14]=s=>ve(y)?y.value=s:null),"max-width":"1250"},{default:e(()=>[t(B,null,{default:e(()=>[t(J,{class:"ios-margin"},{default:e(()=>[t(K,{color:"transparent"},{default:e(()=>[t(Q,null,{default:e(()=>[p(u(l(o)("dialogs.torrentCreator.title")),1)]),_:1}),t(g,{icon:"mdi-close",onClick:z})]),_:1})]),_:1}),t(X,null,{default:e(()=>[t(l(Ee),{modelValue:k.value,"onUpdate:modelValue":r[12]||(r[12]=s=>k.value=s),ref_key:"form",ref:f,onSubmit:r[13]||(r[13]=W(()=>{},["prevent"]))},{default:e(()=>[t(fe,null,{default:e(()=>[t(V,{cols:"12"},{default:e(()=>[t(de,{modelValue:n.sourcePath,"onUpdate:modelValue":r[0]||(r[0]=s=>n.sourcePath=s),title:l(o)("dialogs.torrentCreator.sourcePath"),rules:[s=>!!s||l(o)("dialogs.torrentCreator.rules.sourcePathRequired")]},null,8,["modelValue","title","rules"])]),_:1}),t(V,{cols:"12"},{default:e(()=>[t(de,{modelValue:n.torrentFilePath,"onUpdate:modelValue":r[1]||(r[1]=s=>n.torrentFilePath=s),title:l(o)("dialogs.torrentCreator.torrentFilePath"),rules:[s=>!s||s.endsWith(".torrent")||l(o)("dialogs.torrentCreator.rules.outputFileExtension")]},null,8,["modelValue","title","rules"])]),_:1}),t(E),l(_).usesLibtorrent2?(d(),c(V,{key:0,cols:"12",sm:"6",class:"pb-0"},{default:e(()=>[t(ne,{modelValue:n.format,"onUpdate:modelValue":r[2]||(r[2]=s=>n.format=s),"hide-details":"",items:A,label:l(o)("dialogs.torrentCreator.format")},null,8,["modelValue","label"])]),_:1})):H("",!0),t(V,{cols:"12",sm:l(_).usesLibtorrent2?6:void 0,class:"pb-0"},{default:e(()=>[t(ne,{modelValue:n.pieceSize,"onUpdate:modelValue":r[3]||(r[3]=s=>n.pieceSize=s),"hide-details":"",items:w.value,label:l(o)("dialogs.torrentCreator.pieceSize")},null,8,["modelValue","items","label"])]),_:1},8,["sm"]),l(_).usesLibtorrent1?(d(),F(L,{key:1},[t(V,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(j,{modelValue:n.optimizeAlignment,"onUpdate:modelValue":r[4]||(r[4]=s=>n.optimizeAlignment=s),"hide-details":"",label:l(o)("dialogs.torrentCreator.optimizeAlignment")},null,8,["modelValue","label"])]),_:1}),t(V,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(pe,{modelValue:n.paddedFileSizeLimit,"onUpdate:modelValue":r[5]||(r[5]=s=>n.paddedFileSizeLimit=s),modelModifiers:{number:!0},min:"-1",rules:N,label:l(o)("dialogs.torrentCreator.paddedFileSizeLimit"),hint:l(o)("dialogs.torrentCreator.paddedFileSizeLimitHint"),suffix:"kiB"},null,8,["modelValue","label","hint"])]),_:1})],64)):H("",!0),t(V,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(j,{modelValue:n.private,"onUpdate:modelValue":r[6]||(r[6]=s=>n.private=s),"hide-details":"",label:l(o)("dialogs.torrentCreator.private")},null,8,["modelValue","label"])]),_:1}),t(V,{cols:"12",sm:"6",class:"py-0"},{default:e(()=>[t(j,{modelValue:n.startSeeding,"onUpdate:modelValue":r[7]||(r[7]=s=>n.startSeeding=s),"hide-details":"",label:l(o)("dialogs.torrentCreator.startSeeding")},null,8,["modelValue","label"])]),_:1}),t(E),t(V,{cols:"12"},{default:e(()=>[t(P,{modelValue:n.trackers,"onUpdate:modelValue":r[8]||(r[8]=s=>n.trackers=s),label:l(o)("dialogs.torrentCreator.trackers"),hint:l(o)("dialogs.torrentCreator.trackersHint")},null,8,["modelValue","label","hint"])]),_:1}),t(V,{cols:"12"},{default:e(()=>[t(P,{modelValue:n.urlSeeds,"onUpdate:modelValue":r[9]||(r[9]=s=>n.urlSeeds=s),"hide-details":"",label:l(o)("dialogs.torrentCreator.urlSeeds")},null,8,["modelValue","label"])]),_:1}),l(_).isFeatureAvailable("5.0.3")?(d(),c(V,{key:2,cols:"12"},{default:e(()=>[t(P,{modelValue:n.source,"onUpdate:modelValue":r[10]||(r[10]=s=>n.source=s),"hide-details":"",label:l(o)("dialogs.torrentCreator.source")},null,8,["modelValue","label"])]),_:1})):H("",!0),t(V,{cols:"12"},{default:e(()=>[t(P,{modelValue:n.comment,"onUpdate:modelValue":r[11]||(r[11]=s=>n.comment=s),"hide-details":"",label:l(o)("dialogs.torrentCreator.comment")},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(Ne,null,{default:e(()=>[t(g,{disabled:!k.value,color:"accent",onClick:I},{default:e(()=>[p(u(l(o)("dialogs.torrentCreator.actions.submit")),1)]),_:1},8,["disabled"]),t(g,{color:"error",onClick:z},{default:e(()=>[p(u(l(o)("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}}),Ye={class:"pa-3"},qe={style:{"font-size":"1.6em !important"},class:"subtitle-1 ml-2"},Ge={class:"d-flex justify-end"},We={class:"d-flex align-center flex-gap"},Je={class:"text-no-wrap"},Ke={class:"text-no-wrap"},Qe={class:"text-no-wrap"},Xe={class:"text-no-wrap"},Ze={key:1},et={class:"text-no-wrap"},tt={key:1},lt=["innerHTML"],ot=["innerHTML"],it=ee({__name:"TorrentCreator",setup(U){const{height:S}=Re(),y=Se(),{t:o}=ue(),_=te(),C=Me(),f=ce(),{tasks:k}=_e(f),n=He(),A=he(function*(){yield f.fetchTasks()}).drop(),{isActive:w,pause:N,resume:I}=Le(A.perform,1e3,{immediate:!0,immediateCallback:!0}),z=I,h=G(()=>S.value-64-12*2-48),r=G(()=>[{key:"actions",sortable:!1},{title:o("torrentCreator.table.sourcePath"),key:"sourcePath"},{title:o("torrentCreator.table.status"),key:"status"},{title:o("torrentCreator.table.progress"),key:"progress"},_.usesLibtorrent2?{title:o("torrentCreator.table.format"),key:"format"}:{title:o("torrentCreator.table.optimizeAlignment"),key:"optimizeAlignment"},{title:o("torrentCreator.table.pieceSize"),key:"pieceSize"},{title:o("torrentCreator.table.private"),key:"private"},{title:o("torrentCreator.table.timeAdded"),key:"timeAdded"},{title:o("torrentCreator.table.timeStarted"),key:"timeStarted"},{title:o("torrentCreator.table.timeFinished"),key:"timeFinished"},{title:o("torrentCreator.table.trackers.header"),key:"trackers",sortable:!1},{title:o("torrentCreator.table.urlSeeds.header"),key:"urlSeeds",sortable:!1},{title:o("torrentCreator.table.source"),key:"source"},{title:o("torrentCreator.table.comment"),key:"comment"},{title:o("torrentCreator.table.errorMessage"),key:"errorMessage"}]),s={[T.FAILED]:"error",[T.RUNNING]:"torrent-ul_stalled",[T.QUEUED]:"warning",[T.FINISHED]:"success"},Ve={[x.V1]:"V1",[x.V2]:"V2",[x.HYBRID]:"Hybrid"};function le(){C.createDialog(Oe,{},f.fetchTasks)}async function be(v){const m=await f.downloadTorrent(v.taskID),a=Ae(v.torrentFilePath);let i;a&&a.endsWith(".torrent")?i=a.slice(0,-8):a?i=a:i=v.taskID,Ie(`${i}.torrent`,m)}async function ke(v){await f.deleteTask(v.taskID),z()}const oe=()=>{y.push({name:"dashboard"})};function ae(v){if(C.hasActiveDialog)return!1;v.key==="Escape"&&(v.preventDefault(),oe())}return Fe(async()=>{document.addEventListener("keydown",ae),A.perform()}),xe(()=>{document.removeEventListener("keydown",ae)}),(v,m)=>(d(),F("div",Ye,[t(fe,{"no-gutters":"",align:"center",justify:"center"},{default:e(()=>[t(V,null,{default:e(()=>[b("h1",qe,u(l(o)("torrentCreator.title")),1)]),_:1}),t(V,null,{default:e(()=>[b("div",Ge,[t(g,{icon:"mdi-close",variant:"plain",onClick:oe})])]),_:1})]),_:1}),l(k).length?(d(),c(Y,{key:1},{default:e(()=>[t(M,null,{default:e(()=>[b("div",We,[t(O),t(g,{color:"accent","prepend-icon":l(w)?"mdi-timer-pause":"mdi-timer-play",text:l(w)?l(o)("common.pause"):l(o)("common.resume"),onClick:m[1]||(m[1]=a=>l(w)?l(N)():l(I)())},null,8,["prepend-icon","text"]),t(g,{color:"accent","prepend-icon":"mdi-plus",text:l(o)("torrentCreator.table.create"),onClick:le},null,8,["text"])])]),_:1}),t(E,{class:"my-3"}),t(M,{class:"text-select"},{default:e(()=>[t(je,{"header-props":{class:"text-no-wrap"},mobile:null,headers:r.value,items:l(k),"multi-sort":"","footer-props":{itemsPerPageOptions:[10,25,50,100,-1]}},{"item.status":e(({item:a,value:i})=>[b("span",{class:Te(`text-${s[a.status]}`)},u(l(o)(`constants.torrentCreatorTaskStatus.${i.toLowerCase()}`)),3)]),"item.progress":e(({item:a,value:i})=>[a.status===l(T).RUNNING?(d(),c(ie,{key:0,"model-value":i,color:s[a.status],height:20,rounded:"sm",style:{width:"10em"}},{default:e(()=>[p(u(i)+" % ",1)]),_:2},1032,["model-value","color"])):(d(),c(ie,{key:1,"model-value":100,color:s[a.status],height:20,rounded:"sm",style:{width:"10em"}},{default:e(()=>[p(u(l(Ue)(1)),1)]),_:2},1032,["color"]))]),"item.format":e(({value:a})=>[p(u(Ve[a]),1)]),"item.pieceSize":e(({value:a})=>[p(u(l(me)(a,l(n).useBinarySize,0)),1)]),"item.private":e(({value:a})=>[a?(d(),c(D,{key:0,color:"accent"},{default:e(()=>m[2]||(m[2]=[p("mdi-check-bold")])),_:1})):(d(),c(D,{key:1,color:"error"},{default:e(()=>m[3]||(m[3]=[p("mdi-close-thick")])),_:1}))]),"item.optimizeAlignment":e(({value:a})=>[a?(d(),c(D,{key:0,color:"accent"},{default:e(()=>m[4]||(m[4]=[p("mdi-check-bold")])),_:1})):(d(),c(D,{key:1,color:"error"},{default:e(()=>m[5]||(m[5]=[p("mdi-close-thick")])),_:1}))]),"item.timeAdded":e(({value:a})=>[b("div",Je,u(l($)(a).format(l(n).dateFormat)),1)]),"item.timeFinished":e(({value:a})=>[b("div",Ke,u(l($)(a).format(l(n).dateFormat)),1)]),"item.timeStarted":e(({value:a})=>[b("div",Qe,u(l($)(a).format(l(n).dateFormat)),1)]),"item.trackers":e(({value:a})=>[a&&a.length&&!a.every(i=>!i.length)?(d(),c(Z,{key:0},{activator:e(({props:i})=>[b("div",Xe,[b("span",null,u(l(o)("torrentCreator.table.trackers.activator",a.filter(R=>R.length).length)),1),t(D,se({class:"ml-1"},i),{default:e(()=>m[6]||(m[6]=[p("mdi-information")])),_:2},1040)])]),default:e(()=>[t(B,null,{default:e(()=>[t(J,{class:"ios-margin"},{default:e(()=>[t(K,{color:"transparent"},{default:e(()=>[t(Q,null,{default:e(()=>[p(u(l(o)("torrentCreator.table.trackers.title")),1)]),_:1}),t(O),t(g,{icon:"mdi-close"})]),_:1})]),_:1}),t(X,null,{default:e(()=>[t(Y,null,{default:e(()=>[(d(!0),F(L,null,re(a,i=>(d(),F(L,null,[i?(d(),c(M,{key:0},{default:e(()=>[p(u(i),1)]),_:2},1024)):(d(),c(E,{key:1}))],64))),256))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):(d(),F("span",Ze,u(l(o)("common.none")),1))]),"item.urlSeeds":e(({value:a})=>[a&&a.length&&!a.every(i=>!i.length)?(d(),c(Z,{key:0},{activator:e(({props:i})=>[b("div",et,[b("span",null,u(l(o)("torrentCreator.table.urlSeeds.activator",a.filter(R=>R.length).length)),1),t(D,se({class:"ml-1"},i),{default:e(()=>m[7]||(m[7]=[p("mdi-information")])),_:2},1040)])]),default:e(()=>[t(B,null,{default:e(()=>[t(J,{class:"ios-margin"},{default:e(()=>[t(K,{color:"transparent"},{default:e(()=>[t(Q,null,{default:e(()=>[p(u(l(o)("torrentCreator.table.urlSeeds.title")),1)]),_:1}),t(O),t(g,{icon:"mdi-close"})]),_:1})]),_:1}),t(X,null,{default:e(()=>[t(Y,null,{default:e(()=>[(d(!0),F(L,null,re(a.filter(i=>i.length),i=>(d(),F(L,null,[i?(d(),c(M,{key:0},{default:e(()=>[p(u(i),1)]),_:2},1024)):H("",!0)],64))),256))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):(d(),F("span",tt,u(l(o)("common.none")),1))]),"item.comment":e(({value:a})=>[b("div",{class:"text-no-wrap",innerHTML:a?.length?a.replaceAll(`
`,"<br>"):""},null,8,lt)]),"item.errorMessage":e(({value:a})=>[b("div",{class:"text-no-wrap",innerHTML:a?.length?a.replaceAll(`
`,"<br>"):""},null,8,ot)]),"item.actions":e(({item:a})=>[t(g,{disabled:a.status!==l(T).FINISHED,color:"accent",icon:"mdi-download",variant:"text",density:"compact",onClick:W(i=>be(a),["stop"])},null,8,["disabled","onClick"]),t(g,{color:"red",icon:"mdi-delete",variant:"text",density:"compact",onClick:W(i=>ke(a),["stop"])},null,8,["onClick"])]),_:2},1032,["headers","items"])]),_:1})]),_:1})):(d(),c(B,{key:0,height:h.value},{default:e(()=>[t($e,{title:l(o)("torrentCreator.empty.value"),color:"accent",icon:"mdi-cog-off"},{actions:e(()=>[t(g,{text:l(o)("torrentCreator.empty.action"),color:"accent",onClick:m[0]||(m[0]=a=>le())},null,8,["text"])]),_:1},8,["title"])]),_:1},8,["height"]))]))}});export{it as default};
